#!/usr/bin/env bash

LIBGIT2="`pwd`/git2"
mkdir -p "${LIBGIT2}"
mkdir libgit2
cd libgit2
git init
git remote add origin https://github.com/libgit2/libgit2.git
git pull origin v0.24.3
mkdir build
cd build
cmake .. \
  -DCMAKE_INSTALL_PREFIX="${LIBGIT2}" \
  -DBUILD_CLAR=off
cmake --build . --target install
cd ../..
export CRYSTAL_GIT_LDFLAGS="-L${LIBGIT2}/lib -rpath ${LIBGIT2}/lib"
crystal spec -D travis
